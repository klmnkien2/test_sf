{% extends 'GaoC5Bundle::layout.html.twig' %}
{% block datapage %}data-pageId="default_gd"{% endblock %}
{% set menu_selected = 'gd' %}
{% set userCurrentState = app.security.getToken().getUser().getPdGdState() %}
{% block contents_main %}
    <div class="clearfix boxHead">
        <h1 class="title"><i class="glyphicon glyphicon-screenshot"></i> Trang chủ</h1>
    </div>

    <div class="clearfix boxEnter">
        {% for flashMessage in app.session.flashbag.get('success') %}
            <div class="alert alert-info">
                {{ flashMessage }}
            </div>
        {% endfor %}
        {% for flashMessage in app.session.flashbag.get('unsuccess') %}
            <div class="alert alert-danger">
                {{ flashMessage }}
            </div>
        {% endfor %}
        <div class="alert alert-{{ mode == 'error' ? 'danger' : 'info' }}">
            {{ message }}
        </div>
        {% if mode != 'error' %}
        <form class="form" role="form" action="" method="post">
            <div class="form-group">
                <div class="row">
                    <div class="col-md-6 col-sm-3">
                        <label for="">PIN</label>
                        <input type="text" class="form-control" id="" name="pin_number" placeholder="Mã Pin" 
                        {% if mode == 'tran' and current_gd %} disabled value="{{ current_gd.pinNumber }}" {% endif %} />
                    </div>
                    <div class="col-md-6 col-sm-3">
                        <label for="">Thời điểm yêu cầu</label>
                        <input type="text" class="form-control" disabled 
                        {% if mode == 'tran' and current_gd %} value="{{ current_gd.created |date('d/m/Y H:i:s') }}" {% else %} value="Chua tao PIN" {% endif %} />
                    </div>
                </div>
            </div>
            {% if mode == 'pin' %}
                <div class="btnWrap"><button type="submit" name="submit" class="btn btn-orange">Gui ma pin</button></div>
            {% endif %}
        </form>
        {% endif %}
    </div>

    {% if mode == 'tran' and userCurrentState == 'GD_Matched' %}
    <div class="clearfix boxBody">
        {% if transactionList and transactionList is not empty %}
        <h4>Danh sách người chuyển tiền</h4><br>
        <div id="prg-tranAlert"></div>
        <div class="clearfix tblWrap">
            <form class="form" role="form" action="{{ path('gao_c5_transaction_approve') }}" method="post">
                <table id="prg-tranTable" class="tbl">
                    <thead>
                        <tr>
                            <th scope="col">STT</th>
                            <th scope="col">Tên</th>
                            <th scope="col">Số tài khoản</th>
                            <th scope="col">Số tiền</th>
                            <th scope="col">Trạng thái</th>
                            <th scope="col">Ngày phản hồi</th>
                            {#<th scope="col">Phản hồi</th>#}
                            <th scope="col" align="center">
                                <div class="checkbox">
                                    <label>
                                       <strong>Chọn tất cả</strong> <input type="checkbox" id="prg-selectAll"/> 
                                    </label>
                                </div>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        {% set total_amount = 0 %}
                        {% for transaction in transactionList %}
                            <tr>
                                <td>{{ loop.index }}</td>
                                <td>{{ transaction.full_name | default('N/A') }}</td>
                                <td>{{ transaction.pd_acc_number | default('N/A') }}</td>
                                <td>{{ transaction.amount }} VND</td>
                                <td>
                                    {% if transaction.status == 1 %}
                                        <span style="color: blue; font-weight: bold;">Đã xác nhận</span>
                                    {% else %}
                                        <span style="color: red;">Đang chờ</span>
                                    {% endif %}
                                </td>
                                <td>{{ transaction.approved_date ? transaction.approved_date|date('d/m/Y H:i:s') : 'N/A' }}</td>
                                {# FOR AJAX WAY ONLY
                                <td>
                                    {% if transaction.status != 1 %}
                                        <button class="prg-approveTran" data-id="{{ transaction.id }}" class="btn btn-success">Da nhan</button>
                                    {% else %}
                                        -
                                    {% endif %}
                                </td>#}
                                <td align="center">
                                    {% if transaction.status != 1 %}
                                        <input name="id[]" value="{{ transaction.id }}" type="checkbox" />
                                    {% else %}
                                        -
                                    {% endif %}
                                </td>
                            </tr>
                            {% set total_amount = total_amount +  transaction.amount%}
                        {% endfor %}
                    </tbody>
                    <tfoot>
                        <tr>
                            <th scope="col" colspan="7">Tổng số tiền : {{ total_amount }} VND</th>
                        </tr>
                    </tfoot>
                </table>
                <div class="btnWrap" style="text-align: right;">
                    <button type="submit" name="submit" class="btn btn-orange">Da nhan tien</button>
                </div>
            </form>
        </div>
        {% else %}
        <strong>Khong co ban ghi nao.</strong>
        {% endif %}
    </div>
    {% endif %}

{% endblock contents_main %}