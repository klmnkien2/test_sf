{% extends 'GaoC5Bundle::layout.html.twig' %}

{% set menu_selected = 'dispute' %}

{% block contents_main %}
    <div class="clearfix boxHead">
        <h1 class="title"><i class="glyphicon glyphicon-screenshot"></i> Chi tiết bằng chứng
        </h1>
    </div>

    <div class="clearfix boxEnter">
        {% for flashMessage in app.session.flashbag.get('success') %}
            <div class="alert alert-info">
                {{ flashMessage }}
            </div>
        {% endfor %}
        {% for flashMessage in app.session.flashbag.get('unsuccess') %}
            <div class="alert alert-danger">
                {{ flashMessage }}
            </div>
        {% endfor %}
        <div class="form-group">
            <label>Ngày tạo</label>
            <p>{{ dispute.created|date('d/m/Y') }}</p>
        </div>
        <div class="form-group">
            <label>Giải trình</label>
            <p>{{ dispute.message }}</p>
        </div>
        <div class="form-group">
            <label>File đính kèm</label>
            {% if attachment_array and attachment_array is not empty %}
                {% for attach in attachment_array %}
                    <p style="color: blue;">{{ attach.name }}</p>
                    <p><a href="{{ attach.url }}" target="_blank"><img src="{{ attach.url }}" style="max-height:50px;max-width:50px;" /></a></p>
                {% endfor %}
            {% else %}
                <p>Khong co ban ghi nao.</p>
            {% endif %}
        </div>
        <div class="form-group">
            <label>Xác nhận từ quản trị</label>
            <p>
                {% if dispute.status == 1 %}
                    <span style="color: blue; font-weight: bold;">Đã xác nhận</span>
                {% elseif dispute.status == 2 %}
                    <span style="color: red; font-weight: bold;">Bị từ chối</span>
                {% else %}
                    <span style="color: orange;">Đang chờ</span>
                {% endif %}
            </p>
        </div>
        <div class="form-group">
            <label>Reference Transaction</label>
            {% if transactionList and transactionList is not empty %}
            <table class="tbl">
                <thead>
                  <tr>
                    <th>STT</th>
                    <th>Tên</th>
                    <th>Số tài khoản</th>
                    <th>Số tiền</th>
                    <th>Trạng thái</th>
                    <th>Ngày phản hồi</th>
                  </tr>
                </thead>
                <tbody>
                    {% for transaction in transactionList if transaction.id == dispute.transaction_id %}
                        <tr>
                            <td>{{ loop.index }}</td>
                            <td>{{ transaction.full_name | default('N/A') }}</td>
                            <td>{{ transaction.gd_acc_number | default('N/A') }}</td>
                            <td>{{ transaction.amount }} VND</td>
                            <td>
                                {% if transaction.status == 1 %}
                                    <span style="color: blue; font-weight: bold;">Đã xác nhận</span>
                                {% else %}
                                    <span style="color: red;">Đang chờ</span>
                                {% endif %}
                            </td>
                            <td>{{ transaction.approved_date ? transaction.approved_date|date('d/m/Y H:i:s') : 'Chưa phản hồi' }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
              </table>
            {% else %}
                <p>Khong co ban ghi nao.</p>
            {% endif %}
        </div>
        {% if dispute.status == 0 %}
          <div class="btnWrap"><a href="{{ path('gao_c5_dispute') }}?transaction_id={{ dispute.transaction_id }}" class="btn btn-orange">Cập nhật lại</a></div>
        {% endif %}
    </div>
  </div>
{% endblock contents_main %}
